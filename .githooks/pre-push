#!/usr/bin/env bash
set -euo pipefail

# Blocks direct pushes to protected branches from local git.
# Override once (if truly needed):
#   ALLOW_PROTECTED_PUSH=1 git push origin main

if [[ "${ALLOW_PROTECTED_PUSH:-0}" == "1" ]]; then
  exit 0
fi

while read -r local_ref local_sha remote_ref remote_sha; do
  case "$remote_ref" in
    refs/heads/main)
      echo "‚ùå Direct pushes to 'main' are blocked."
      echo "Create a feature branch and open a PR instead."
      echo "(Temporary override: ALLOW_PROTECTED_PUSH=1 git push origin main)"
      exit 1
      ;;
  esac
done

exit 0
